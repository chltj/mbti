<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title th:text="${room.name} + ' - 소통의 방'">소통의 방</title>

    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/room.css}">
</head>
<body>

<div th:replace="fragments/header :: siteHeader"></div>

<div class="page-wrap">

    <!-- 방 타이틀 -->
    <h2 class="page-title">
        <span>💬</span>
        <span th:text="${room.name}">방 이름</span>
    </h2>
    <p class="page-sub">
        인원
        <b th:text="${room.currentCount} + ' / ' + ${room.maxCount}"></b>
        · 참여자:
        <span th:each="m, iter : ${room.members}">
            <span th:text="${m}"></span><span th:if="${!iter.last}">, </span>
        </span>
    </p>

    <!-- 채팅 영역 -->
    <!-- ✅ 인라인 style 제거하고 chat-card 클래스 추가 -->
    <div class="card chat-card">
        <div th:if="${#lists.isEmpty(messages)}" class="chat-empty">
            아직 메시지가 없습니다. 먼저 말을 걸어보세요 😊
        </div>

        <!-- ✅ 인라인 style 대신 chat-message 클래스 사용 -->
        <div th:each="msg : ${messages}" class="chat-message">
            <div class="chat-header">
                <span class="chat-sender" th:text="${msg.sender}">닉네임</span>
                <span class="chat-time"
                      th:text="${#temporals.format(msg.sentAt, 'HH:mm')}">12:34</span>
            </div>
            <div class="chat-content" th:text="${msg.content}"></div>
        </div>
    </div>

    <!-- 메시지 입력 -->
    <form th:action="@{'/chat/rooms/' + ${room.id} + '/message'}"
          method="post">
        <div class="form-row">
            <textarea name="content"
                      class="form-input"
                      rows="2"
                      placeholder="메시지를 입력하세요"
                      required></textarea>
        </div>
        <button type="submit" class="btn-submit">보내기</button>
        <a th:href="@{/chat/rooms}" class="btn-secondary" style="margin-left:8px;">
            방 목록으로
        </a>
    </form>

</div>

<div th:replace="fragments/footer :: siteFooter"></div>

</body>
</html>
