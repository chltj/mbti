<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¡œê·¸ì¸</title>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- ê³µí†µ CSS -->
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <!-- ë¡œê·¸ì¸ í˜ì´ì§€ ì „ìš© CSS -->
    <link rel="stylesheet" th:href="@{/css/login.css}">
</head>
<body>

<div th:replace="fragments/header :: siteHeader"></div>

<div class="page-wrap">
    <h2 class="page-title">
        <span>ğŸ”</span>
        <span>ë¡œê·¸ì¸</span>
    </h2>

    <p class="page-sub">
        ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸í•˜ê±°ë‚˜<br>
        ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ê°„í¸ ë¡œê·¸ì¸í•  ìˆ˜ ìˆì–´ìš”.
    </p>

    <div class="card login-card">

        <!-- ë¡œê·¸ì¸ ì‹¤íŒ¨ ë©”ì‹œì§€ -->
        <div th:if="${loginError}" class="error-msg">
            <p th:text="${loginError}"></p>
        </div>

        <!-- ì¼ë°˜ ë¡œê·¸ì¸ -->
        <form th:action="@{/login}" method="post" class="normal-login-form">

            <!-- ì•„ì´ë”” -->
            <div class="form-row">
                <label class="form-label">ì•„ì´ë””</label>
                <input type="text" name="loginId"
                       class="form-input"
                       placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                       required>
            </div>

            <!-- ë¹„ë°€ë²ˆí˜¸ -->
            <div class="form-row">
                <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" name="password"
                       class="form-input"
                       placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                       required>
            </div>

            <button type="submit" class="btn-submit full">
                ë¡œê·¸ì¸
            </button>
        </form>

        <!-- êµ¬ë¶„ì„  -->
        <div class="divider">ë˜ëŠ”</div>

        <!-- ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ -->
        <div class="login-btn-wrap">
            <a id="kakao-login-btn" href="#" class="kakao-btn">
                <img id="login-img"
                     src="https://k.kakaocdn.net/14/dn/btroDszwNrM/I6efHub1SN5KCJqLm1Ovx1/o.jpg"
                     alt="ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼">
            </a>
        </div>

        <!-- íšŒì›ê°€ì… ìœ ë„ -->
        <div class="signup-box">
            ì•„ì§ ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”?
            <a th:href="@{/signup}" class="signup-link">íšŒì›ê°€ì…</a>
        </div>

        <p id="result" class="login-msg"></p>
    </div>
</div>

<div th:replace="fragments/footer :: siteFooter"></div>

<script src="https://developers.kakao.com/sdk/js/kakao.js"></script>

<script>
    Kakao.init('99a1f32a3d1e4592669ec778f7bb36d2');

    const loginBtn = document.getElementById('kakao-login-btn');

    function loginWithKakao() {
        Kakao.Auth.login({
            scope: 'profile_nickname, profile_image, account_email',
            success: function() {
                Kakao.API.request({
                    url: '/v2/user/me',
                    success: function(res) {
                        const name = res.kakao_account.profile.nickname;
                        const email = res.kakao_account.email;

                        const params = new URLSearchParams();
                        params.append("nickname", name);
                        if (email) {
                            params.append("email", email);
                        }

                        window.location.href = "/kakao-login?" + params.toString();
                    }
                });
            }
        });
    }

    loginBtn.addEventListener('click', function(e) {
        e.preventDefault();
        loginWithKakao();
    });
</script>

</body>
</html>
