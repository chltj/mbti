<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¡œê·¸ì¸</title>

    <!-- ê³µí†µ CSS -->
    <link rel="stylesheet" th:href="@{/css/common.css}">

    <!-- ë¡œê·¸ì¸ í˜ì´ì§€ ì „ìš© CSS -->
    <link rel="stylesheet" th:href="@{/css/login.css}">
</head>
<body>

<div th:replace="fragments/header :: siteHeader"></div>

<div class="page-wrap">
    <h2 class="page-title">
        <span>ğŸ”</span>
        <span>ë¡œê·¸ì¸</span>
    </h2>

    <p class="page-sub">
        ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ê°„í¸ ë¡œê·¸ì¸í•˜ê±°ë‚˜<br>
        ì´ë©”ì¼ íšŒì›ê°€ì…ìœ¼ë¡œ ì´ìš©í•  ìˆ˜ ìˆì–´ìš”.
    </p>

    <div class="card login-card">
    <!-- ë¡œê·¸ì¸ ì‹¤íŒ¨ ë©”ì‹œì§€ -->
    <div th:if="${loginError}" class="error-msg">
        <p th:text="${loginError}"></p>
    </div>
        <!-- ì¼ë°˜ ë¡œê·¸ì¸ -->
        <form th:action="@{/login}" method="post" class="normal-login-form">

            <div class="form-row">
                <label class="form-label">ì´ë©”ì¼</label>
                <input type="email" name="email" class="form-input" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" required>
            </div>

            <div class="form-row">
                <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" name="password" class="form-input" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
            </div>

            <button type="submit" class="btn-submit full">
                ë¡œê·¸ì¸
            </button>
        </form>

        <!-- êµ¬ë¶„ì„  -->
        <div class="divider">ë˜ëŠ”</div>

        <!-- ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ -->
        <div class="login-btn-wrap">
            <a id="kakao-login-btn" href="#" class="kakao-btn">
                <img id="login-img"
                     src="https://k.kakaocdn.net/14/dn/btroDszwNrM/I6efHub1SN5KCJqLm1Ovx1/o.jpg"
                     alt="ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼">
            </a>
        </div>

        <!-- íšŒì›ê°€ì… ìœ ë„ -->
        <div class="signup-box">
            ì•„ì§ ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”?
            <a th:href="@{/signup}" class="signup-link">íšŒì›ê°€ì…</a>
        </div>

        <p id="result" class="login-msg"></p>
    </div>
</div>

<div th:replace="fragments/footer :: siteFooter"></div>

<script src="https://developers.kakao.com/sdk/js/kakao.js"></script>

<script>
    Kakao.init('99a1f32a3d1e4592669ec778f7bb36d2');

    const loginBtn = document.getElementById('kakao-login-btn');

    function loginWithKakao() {
        Kakao.Auth.login({
            scope: 'profile_nickname, profile_image, account_email',
            success: function() {
                Kakao.API.request({
                    url: '/v2/user/me',
                    success: function(res) {
                        const name = res.kakao_account.profile.nickname;
                        const email = res.kakao_account.email;  // ì´ë©”ì¼ ê¶Œí•œ í—ˆìš©í–ˆì„ ë•Œ

                        // â˜… ë” ì´ìƒ localStorageì—ë§Œ ì €ì¥í•˜ì§€ ì•Šê³ 
                        //    ì„œë²„ë¡œ ë³´ë‚´ì„œ ì„¸ì…˜ì— ë¡œê·¸ì¸ ì •ë³´ ì €ì¥í•˜ê²Œ í•¨
                        const params = new URLSearchParams();
                        params.append("nickname", name);
                        if (email) {
                            params.append("email", email);
                        }

                        // /kakao-login ìœ¼ë¡œ ì´ë™ â†’ ì„œë²„ì—ì„œ ì„¸ì…˜ ì„¤ì • í›„ ë©”ì¸ìœ¼ë¡œ redirect
                        window.location.href = "/kakao-login?" + params.toString();
                    }
                });
            }
        });
    }

    loginBtn.addEventListener('click', function(e) {
        e.preventDefault();
        loginWithKakao();
    });

    // â˜… localStorage ê¸°ë°˜ í™˜ì˜ë©”ì‹œì§€ëŠ” ë” ì´ìƒ ì‚¬ìš© ì•ˆ í•¨
</script>

</body>
</html>
