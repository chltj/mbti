<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.k_mbti.dao.UserDao">

    <!-- 이메일로 유저 찾기 -->
    <select id="findByEmail"
            parameterType="string"
            resultType="com.example.k_mbti.dto.UserDto">
        SELECT
            id,
            login_id   AS loginId,
            email,
            nickname,
            password,
            phone,
            created_at AS createdAt
        FROM users
        WHERE email = #{email}
    </select>

    <!-- login_id 로 찾기 -->
    <select id="findByLoginId"
            parameterType="string"
            resultType="com.example.k_mbti.dto.UserDto">
        SELECT
            id,
            login_id   AS loginId,
            email,
            nickname,
            password,
            phone,
            created_at AS createdAt
        FROM users
        WHERE login_id = #{loginId}
    </select>

    <!-- PK로 찾기 -->
    <select id="findById"
            parameterType="long"
            resultType="com.example.k_mbti.dto.UserDto">
        SELECT
            id,
            login_id   AS loginId,
            email,
            nickname,
            password,
            phone,
            created_at AS createdAt
        FROM users
        WHERE id = #{id}
    </select>

    <!-- 회원가입 -->
    <insert id="insertUser"
            parameterType="com.example.k_mbti.dto.UserDto">
        INSERT INTO users (
            login_id,
            email,
            nickname,
            password,
            phone,
            created_at
        ) VALUES (
            #{loginId},
            #{email},
            #{nickname},
            #{password},
            #{phone},
            NOW()
        )
    </insert>

    <!-- ✅ 내 정보 수정 (닉네임 / 이메일 / 전화번호 / (선택) 비밀번호) -->
    <update id="updateProfile"
            parameterType="com.example.k_mbti.dto.UserDto">
        UPDATE users
        SET
            nickname = #{nickname},
            email    = #{email},
            phone    = #{phone}
            <if test="password != null and password != ''">
                , password = #{password}
            </if>
        WHERE id = #{id}
    </update>

</mapper>
